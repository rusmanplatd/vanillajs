<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Design System Demo (with Manifest)</title>
    <!-- CSS will be loaded dynamically with cache-busted filenames -->
    <style>
      /* Same styles as original demo */
      .demo-section {
        margin-bottom: var(--spacing-12);
      }

      .control-panel {
        position: sticky;
        top: var(--spacing-4);
        background: var(--color-surface);
        padding: var(--spacing-6);
        border-radius: var(--card-radius);
        box-shadow: var(--card-shadow);
      }

      .control-group {
        margin-bottom: var(--spacing-6);
      }

      .control-label {
        display: block;
        margin-bottom: var(--spacing-2);
        font-weight: var(--font-weight-medium);
        color: var(--color-on-surface);
      }

      .layout-grid {
        display: grid;
        grid-template-columns: 300px 1fr;
        gap: var(--spacing-6);
        margin-top: var(--spacing-6);
      }

      @media (max-width: 960px) {
        .layout-grid {
          grid-template-columns: 1fr;
        }

        .control-panel {
          position: static;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header style="text-align: center; padding: var(--spacing-12) 0">
        <h1>üé® Design System (Manifest Loader)</h1>
        <p style="font-size: var(--font-size-xl); color: var(--color-neutral-600)">
          Using cache-busted assets with manifest.json
        </p>
      </header>

      <div class="layout-grid">
        <!-- Control Panel -->
        <aside class="control-panel">
          <h3 style="margin-bottom: var(--spacing-6)">Theme Controls</h3>

          <div class="control-group">
            <label class="control-label">Theme</label>
            <select id="themeSelect" class="input">
              <option value="light">Light</option>
              <option value="dark">Dark</option>
              <option value="high-contrast">High Contrast</option>
            </select>
          </div>

          <div class="control-group">
            <label class="control-label">Density</label>
            <select id="densitySelect" class="input">
              <option value="default">Default</option>
              <option value="compact">Compact</option>
              <option value="comfortable">Comfortable</option>
            </select>
          </div>

          <div class="control-group">
            <label class="control-label">UI Scale: <span id="scaleValue">1.0</span></label>
            <input type="range" id="scaleSlider" min="0.5" max="2.0" step="0.1" value="1.0" style="width: 100%" />
          </div>

          <div class="control-group">
            <button id="resetBtn" class="btn btn-outlined" style="width: 100%"> Reset to Defaults </button>
          </div>

          <hr class="divider" />

          <div id="systemInfo" style="font-size: var(--font-size-sm)"></div>
        </aside>

        <!-- Main Content -->
        <main>
          <div class="card">
            <h2 class="card-title">Manifest Loader Demo</h2>
            <div class="card-body">
              <p class="mb-4">
                This demo uses the manifest loader to dynamically load cache-busted JavaScript modules.
              </p>
              <div class="alert alert-info">
                <strong>Loaded Module:</strong> <span id="loadedModule">Loading...</span>
              </div>
            </div>
          </div>
        </main>
      </div>
    </div>

    <script type="module">
      import { loadScript, loadStyle } from '../dist/js/manifest-loader.1759462964683.09af92db.js';

      // Load CSS bundle first
      loadStyle('css/styles.bundle.min.css', '/dist/bundle/manifest.json')
        .then(() => {
          console.log('‚úÖ CSS bundle loaded');

          // Then load the theme manager bundle
          return loadScript('js/theme.bundle.min.js', '/dist/bundle/manifest.json');
        })
        .then((module) => {
          console.log('Module loaded:', module);
          const { themeManager } = module;

          if (!themeManager) {
            throw new Error('themeManager not found in module');
          }

          document.getElementById('loadedModule').textContent = 'theme.bundle.min.js (versioned)';

          // Set up theme controls
          document.getElementById('themeSelect').addEventListener('change', (e) => {
            themeManager.setTheme(e.target.value);
          });

          document.getElementById('densitySelect').addEventListener('change', (e) => {
            themeManager.setDensity(e.target.value);
          });

          document.getElementById('scaleSlider').addEventListener('input', (e) => {
            const scale = parseFloat(e.target.value);
            document.getElementById('scaleValue').textContent = scale.toFixed(1);
            themeManager.setScale(scale);
          });

          document.getElementById('resetBtn').addEventListener('click', () => {
            themeManager.resetToDefaults();
            const config = themeManager.config$.getValue();
            document.getElementById('themeSelect').value = config.theme;
            document.getElementById('densitySelect').value = config.density;
            document.getElementById('scaleSlider').value = '1.0';
            document.getElementById('scaleValue').textContent = '1.0';
          });

          // Display system info using observable
          const config = themeManager.config$.getValue();
          document.getElementById('systemInfo').innerHTML = `
            <strong>Current Theme:</strong> ${config.theme}<br>
            <strong>Density:</strong> ${config.density}<br>
            <strong>Scale:</strong> ${config.scale}
          `;

          console.log('‚úÖ Theme manager loaded from manifest');
        })
        .catch((error) => {
          document.getElementById('loadedModule').textContent = 'Failed to load';
          console.error('‚ùå Failed to load module:', error);
        });
    </script>
  </body>
</html>
